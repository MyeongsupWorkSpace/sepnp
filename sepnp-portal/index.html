<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SEPNP í¬í„¸ ë¡œê·¸ì¸</title>
  <style>
    :root {
      --primary: #667eea;
      --primary-dark: #5568d3;
      --bg: #f5f6f8;
      --card: #fff;
      --border: #e5e7eb;
      --text: #111827;
      --text-muted: #6b7280;
      --error: #ef4444;
      --success: #10b981;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .login-container {
      width: 100%;
      max-width: 420px;
    }
    
    .login-card {
      background: var(--card);
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      animation: slideUp 0.4s ease-out;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .logo {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .logo-icon {
      font-size: 48px;
      margin-bottom: 8px;
    }
    
    .logo-text {
      font-size: 28px;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .logo-subtitle {
      color: var(--text-muted);
      font-size: 14px;
      margin-top: 4px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      font-weight: 600;
      font-size: 14px;
      color: var(--text);
      margin-bottom: 8px;
    }
    
    .form-control {
      width: 100%;
      height: 48px;
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 0 16px;
      font-size: 15px;
      transition: all 0.2s;
      background: #fafafa;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      background: #fff;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }
    
    .btn {
      width: 100%;
      height: 48px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 24px;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .alert {
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 20px;
      display: none;
      animation: slideDown 0.3s ease-out;
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .alert.show {
      display: block;
    }
    
    .alert-error {
      background: #fee;
      color: var(--error);
      border: 1px solid #fcc;
    }
    
    .alert-success {
      background: #efe;
      color: var(--success);
      border: 1px solid #cfc;
    }
    
    .links {
      text-align: center;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }
    
    .links a {
      color: var(--primary);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
    }
    
    .links a:hover {
      text-decoration: underline;
    }
    
    .test-accounts {
      margin-top: 20px;
      padding: 16px;
      background: #f9fafb;
      border-radius: 8px;
      font-size: 12px;
      color: var(--text-muted);
    }
    
    .test-accounts h4 {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text);
    }
    
    .test-accounts code {
      background: #fff;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      color: var(--primary);
    }
    
    .divider {
      display: flex;
      align-items: center;
      text-align: center;
      margin: 20px 0;
      color: var(--text-muted);
      font-size: 13px;
    }
    
    .divider::before,
    .divider::after {
      content: '';
      flex: 1;
      border-bottom: 1px solid var(--border);
    }
    
    .divider span {
      padding: 0 10px;
    }
  </style>
</head>
<body class="landing-page">
  <div class="login-container">
    <div class="login-card">
      <div class="logo">
        <div class="logo-icon">ğŸ¢</div>
        <div class="logo-text">SEPNP</div>
        <div class="logo-subtitle">ìƒì‚° ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
      </div>

      <div id="loginAlert" class="alert"></div>

      <form id="loginForm">
        <div class="form-group">
          <label class="form-label" for="loginId">ì•„ì´ë”” ë˜ëŠ” ì‚¬ë²ˆ</label>
          <input 
            type="text" 
            id="loginId" 
            class="form-control" 
            placeholder="sepnp ë˜ëŠ” ADMIN"
            autocomplete="username" 
            required
          >
        </div>
        
        <div class="form-group">
          <label class="form-label" for="loginPassword">ë¹„ë°€ë²ˆí˜¸</label>
          <input 
            type="password" 
            id="loginPassword" 
            class="form-control" 
            placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
            autocomplete="current-password" 
            required
          >
        </div>

        <button type="submit" class="btn" id="loginBtn">
          ë¡œê·¸ì¸
        </button>
      </form>

      <div class="divider">
        <span>ë˜ëŠ”</span>
      </div>

      <div class="links">
        <a href="register.html">íšŒì›ê°€ì…</a>
      </div>

      <div class="test-accounts">
        <h4>ğŸ’¡ í…ŒìŠ¤íŠ¸ ê³„ì •</h4>
        <div style="line-height:1.6">
          ê´€ë¦¬ì: <code>sepnp / 0536</code> ë˜ëŠ” <code>test / 123</code><br>
          ì¸ì‡„: <code>print / 1234</code><br>
          í†°ìŠ¨: <code>thomson / 1234</code><br>
          ì½”íŒ…: <code>coating / 1234</code><br>
          ì ‘ì°©: <code>adhesive / 1234</code><br>
          í•©ì§€: <code>lamination / 1234</code>
        </div>
      </div>
    </div>
  </div>

  <!-- API ëª¨ë“ˆ ë¨¼ì € ë¡œë“œ -->
  <script src="assets/api.js"></script>
  <script src="assets/auth.js"></script>
  
  <script>
    const loginForm = document.getElementById('loginForm');
    const loginBtn = document.getElementById('loginBtn');
    const loginAlert = document.getElementById('loginAlert');
    const loginIdInput = document.getElementById('loginId');
    const loginPasswordInput = document.getElementById('loginPassword');

    function showAlert(message, type = 'error') {
      loginAlert.textContent = message;
      loginAlert.className = `alert alert-${type} show`;
      
      setTimeout(() => {
        loginAlert.classList.remove('show');
      }, 4000);
    }

    // MySQL ë¡œê·¸ì¸
    async function loginWithMySQL(loginId, password) {
      try {
        const result = await API.login(loginId, password);
        
        if (result.ok) {
          sessionStorage.setItem('sepnp_emp_no', result.emp.empNo);
          sessionStorage.setItem('sepnp_emp_name', result.emp.name);
          sessionStorage.setItem('sepnp_emp_role', result.emp.role);
          sessionStorage.setItem('sepnp_emp_username', result.emp.username);
          
          if (result.emp.perms) {
            sessionStorage.setItem('sepnp_emp_perms', JSON.stringify(result.emp.perms));
          }
          
          showAlert('ë¡œê·¸ì¸ ì„±ê³µ! (MySQL)', 'success');
          
          setTimeout(() => {
            window.location.href = 'employee.html';
          }, 500);
          
          return true;
        }
      } catch (error) {
        console.error('MySQL ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
        return false;
      }
    }

    // localStorage ë¡œê·¸ì¸ (í´ë°±)
    async function loginWithLocalStorage(loginId, password) {
      try {
        const result = await Auth.signIn(loginId, password);
        
        if (result.ok) {
          showAlert('ë¡œê·¸ì¸ ì„±ê³µ! (ë¡œì»¬)', 'success');
          
          setTimeout(() => {
            window.location.href = 'employee.html';
          }, 500);
          
          return true;
        } else {
          showAlert(result.msg || 'ë¡œê·¸ì¸ ì‹¤íŒ¨', 'error');
          return false;
        }
      } catch (error) {
        console.error('ë¡œì»¬ ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
        return false;
      }
    }

    // ë¡œê·¸ì¸ í¼ ì œì¶œ
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const loginId = loginIdInput.value.trim();
      const password = loginPasswordInput.value;
      
      if (!loginId || !password) {
        showAlert('IDì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
        return;
      }

      loginBtn.disabled = true;
      loginBtn.textContent = window.USE_MYSQL ? 'MySQL ë¡œê·¸ì¸ ì¤‘...' : 'ë¡œê·¸ì¸ ì¤‘...';

      let success = false;

      if (window.USE_MYSQL) {
        success = await loginWithMySQL(loginId, password);
        
        if (!success) {
          console.log('MySQL ì‹¤íŒ¨, localStorageë¡œ ì¬ì‹œë„...');
          success = await loginWithLocalStorage(loginId, password);
        }
      } else {
        success = await loginWithLocalStorage(loginId, password);
      }

      if (!success) {
        loginBtn.disabled = false;
        loginBtn.textContent = 'ë¡œê·¸ì¸';
      }
    });

    // Enter í‚¤ ì²˜ë¦¬
    loginPasswordInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        loginForm.dispatchEvent(new Event('submit'));
      }
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ
    window.addEventListener('DOMContentLoaded', () => {
      loginIdInput.focus();
      
      // ì´ë¯¸ ë¡œê·¸ì¸ë˜ì–´ ìˆìœ¼ë©´ ë¦¬ë””ë ‰ì…˜
      const empNo = sessionStorage.getItem('sepnp_emp_no');
      if (empNo) {
        window.location.href = 'employee.html';
      }

      // ëª¨ë“œ í‘œì‹œ
      console.log(`ğŸ”§ ë¡œê·¸ì¸ ëª¨ë“œ: ${USE_MYSQL ? 'MySQL' : 'localStorage'}`);
    });

    // ë””ë²„ê·¸ ëª¨ë“œ (Ctrl + Shift + D)
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.shiftKey && e.key === 'D') {
        console.log('=== ë””ë²„ê·¸ ì •ë³´ ===');
        console.log('ëª¨ë“œ:', USE_MYSQL ? 'MySQL' : 'localStorage');
        console.log('API ì„œë²„:', 'http://localhost:3000');
        console.log('ì„¸ì…˜:', {
          empNo: sessionStorage.getItem('sepnp_emp_no'),
          empName: sessionStorage.getItem('sepnp_emp_name'),
          empRole: sessionStorage.getItem('sepnp_emp_role')
        });
        
        if (confirm('ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ìë™ ë¡œê·¸ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          loginIdInput.value = 'sepnp';
          loginPasswordInput.value = '0536';
          loginForm.dispatchEvent(new Event('submit'));
        }
      }
    });
  </script>
</body>
</html>